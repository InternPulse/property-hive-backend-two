generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_DSN")
}
model User {
  id               Int         @id @default(autoincrement())
  email            String         @unique
  firstName        String         @map("fname") 
  lastName         String         @map("lname") 
  businessName     String         @unique @map("business_name") 
  phoneNumber      String?        @unique @map("phone_number") 
  profilePicture    String?       @map("profile_picture") 
  customUrl        String?        @map("custom_url") 
  isCompany        Boolean        @default(false) @map("is_company") 
  isActive         Boolean        @default(true) @map("is_active") 
  isStaff          Boolean        @default(false) @map("is_staff") 
  isSuperuser      Boolean        @default(false) @map("is_superuser") 
  dateJoined       DateTime       @default(now()) @map("date_joined") 
  lastLogin        DateTime?      @map("last_login") 
  updatedAt        DateTime       @updatedAt @map("updated_at") 
  kycDocuments     KycDocuments[] 
  properties       Property[]
  soldProperties    SoldProperties[]
  userProperties   UserProperties[]
  transactions     Transactions[]
  ratings          Ratings[]
  profile          Profile?

  @@map("users")
}


model KycDocuments {
  id          Int   @id @default(autoincrement())
  userid        User      @relation(fields: [userId], references: [id])
  userId        Int
  document_type String?
  document_file String?
  status        String    @default("pending")
  uploaded_at   DateTime  @default(now())

  @@map("kyc_documents")
}

model Property {
  id                Int             @id @default(autoincrement())
  seller            User            @relation(fields: [sellerId], references: [id])
  sellerId          Int
  name              String
  state             String
  city              String
  address           String
  description       String
  squaremeters      String         
  property_type     String
  price             Int
  is_sold           Boolean         @default(false)
  date_sold         DateTime?
  created_at        DateTime        @default(now())
  updated_at        DateTime        @updatedAt
  propertyImages    PropertyImages[]
  propertyDocuments PropertyDocuments[]
  soldProperties    SoldProperties[]
  userProperties    UserProperties[]
  transactions      Transactions[]
  ratings           Ratings[]

  @@map("properties")
}


model PropertyImages {
  id          Int   @id @default(autoincrement())
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  img         String?

  @@map("property_images")
}

model PropertyDocuments {
  id          Int   @id @default(autoincrement())
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  document_type String?
  img         String?
  file_path   String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@map("property_documents")
}

model SoldProperties {
  id          Int   @id @default(autoincrement())
  buyer       User     @relation(fields: [buyerId], references: [id])
  buyerId     Int
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  date_sold   DateTime  @default(now())

  @@map("sold_properties")
}

model UserProperties {
  id          Int   @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  date_purchased DateTime @default(now())

  @@map("user_properties")
}

model Transactions {
  id          Int   @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  status      String    @default("P") // "P" for Pending, "A" for Approved, "F" for Failed
  payment_method String
  total_amount Int
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  invoice    Invoice[]

  @@map("transactions")
}

model Invoice {
  id          Int   @id @default(autoincrement())
  transaction Transactions @relation(fields: [transactionId], references: [id])
  transactionId Int
  payment_status String
  payment_method String
  note         String?
  issue_date   DateTime  @default(now())

  @@map("invoices")
}

model Ratings {
  id          Int   @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int
  property    Property  @relation(fields: [propertyId], references: [id])
  propertyId  Int
  comment     String?
  rate        Int       @default(1)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@map("ratings")
}

model Profile {
  id          Int   @id @default(autoincrement())
  user           User     @relation(fields: [userId], references: [id])
  userId         Int   @unique
  company_logo   String?
  company_banner String?
  company_address String?
  title          String?
  description    String
  instagram      String?
  linkedin       String?
  facebook       String?
  twitter        String?

  @@map("profiles")
}

